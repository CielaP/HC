---------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\AyakaNakamura\Dropbox\materials\Works\Master\program\Submit
> tion\Log\Estimation.log
  log type:  text
 opened on:  10 Nov 2018, 17:40:48

. /*
> 
> 
> 
> * 1. OLS->AS / 1-4 dimenational polynomial
> {
> ** OLS
> *** reading data
> do "$Code\ReadData.do"
> 
> foreach ten_i of local isIncOcc{
>         forvalues poly_x=1/4{
>                 dis "/* OLS `ten_i' `poly_x'th order */"
>                 reg ///
>                                 `commonVar' ///
>                                 ``ten_i'`poly_x'' ///
>                                 , vce(r)
>                 est sto ols`ten_i'`poly_x'
>         }
> }
> 
> ** AS
> foreach ten_i of local isIncOcc{
>         forvalues poly_x=1/4{
>                 qui {
>                         do "$Code\ReadData.do"
>                         do "$Code\ConstructIV.do"
>                         ivregress 2sls ///
>                                                 `commonVar' ///
>                                                 (``ten_i'`poly_x'' = ``ten_i'iv
> `poly_x'') ///
>                                                 , vce(r)
>                         est sto isv`ten_i'`poly_x'
>                         drop if _est_isv`ten_i'`poly_x'==0
>                         drop *iv *iv? avg*
>                         **** re-build iv
>                         do "$Code\ConstructIV.do"
>                 }
>                 dis "/* AS's IV `ten_i' `poly_x'th order */"
>                 ivregress 2sls ///
>                                 `commonVar' ///
>                                 (``ten_i'`poly_x'' = ``ten_i'iv`poly_x'') ///
>                                 , vce(r)
>                 est sto isv`ten_i'`poly_x'
>         }
> }
> 
> ** culc. return
> qui{
>         local culcemp1 _b[oj]+emptenure*_b[emptenure]
>         local culcemp2 _b[oj]+emptenure*_b[emptenure] ///
>                                                         +(emptenure^2)*_b[c.emp
> tenure#c.emptenure]
>         local culcemp3 _b[oj]+emptenure*_b[emptenure] ///
>                                                         +(emptenure^2)*_b[c.emp
> tenure#c.emptenure] ///
>                                                         +(emptenure^3)*_b[c.emp
> tenure#c.emptenure#c.emptenure]
>         local culcemp4 _b[oj]+emptenure*_b[emptenure] ///
>                                                         +(emptenure^2)*_b[c.emp
> tenure#c.emptenure] ///
>                                                         +(emptenure^3)*_b[c.emp
> tenure#c.emptenure#c.emptenure] ///
>                                                         +(emptenure^4)*_b[c.emp
> tenure#c.emptenure#c.emptenure#c.emptenure]
> }
> 
> foreach ten_i of local isIncOcc{ /* loop within emp and empocc */
>         forvalues poly_x=1/4{ /* loop within ten_inomial */
>                 *** culculation
>                 dis "/* `ten_i' `poly_x'th order */"
>                 est res ols`ten_i'`poly_x'
>                 margins, exp(`culcemp`poly_x'') ///
>                 at(emptenure=(0(1)25)) noe post
>                 est sto ols`ten_i'r`poly_x'
>                 est res isv`ten_i'`poly_x'
>                 margins, exp(`culcemp`poly_x'') ///
>                 at(emptenure=(0(1)25)) noe post
>                 est sto isv`ten_i'r`poly_x'
>                 
>                 *** plot
>                 qui coefplot (ols`ten_i'r`poly_x', label(OLS)) (isv`ten_i'r`pol
> y_x', label(IV)), ///
>                 at ciopts(recast(rline) lpattern(dash)) recast(connected) ///
>                 xtitle("Employer Tenure") ytitle("Returns to Tenure on Earnings
>  (%)") ///
>                 yline(0) rescale(100)
>                 graph export "$Output\plot_as_`ten_i'_`poly_x'.pdf", replace
>         }
> }
> 
> ** output tex all results
> {
> qui{
> local labelVar emptenure "Employer tenure" ///
>                                                 c.emptenure#c.emptenure "Emp.te
> n.$^{2}\times 100$" ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure "Emp.ten.$^{3}\times 100$" ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure#c.emptenure "Emp.ten.$^{4}\times 1000$" ///
>                                                 oj "Old job" ///
>                                                 workexp "Total experience" c.wo
> rkexp#c.workexp "Experience$^{2}$" ///
>                                                 c.workexp#c.workexp#c.workexp "
> Exp.$^{3}\times 100$" ///
>                                                 c.workexp#c.workexp#c.workexp#c
> .workexp "Exp.$^{4}\times 10000$"
> local transVar c.emptenure#c.emptenure 100*@ 100 ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure 100*@ 100 ///
>                                                 c.emptenure#c.emptenurec.empten
> ure#c.emptenure 10000*@ 10000 ///
>                                                 c.workexp#c.workexp#c.workexp 1
> 00*@ 100 ///
>                                                 c.workexp#c.workexp#c.workexp 1
> 0000*@ 10000 ///
>                                                 c.occtenure#c.occtenure 100*@ 1
> 00 ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure 100*@ 100 ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure#c.occtenure 10000*@ 10000
> 
> *** coefficients / emp+occ
> local keepVar emptenure c.emptenure#c.emptenure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure#c.emptenure ///
>                                                 oj ///
>                                                 occtenure c.occtenure#c.occtenu
> re ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure#c.occtenure ///
>                                                 workexp c.workexp#c.workexp ///
>                                                 c.workexp#c.workexp#c.workexp /
> //
>                                                 c.workexp#c.workexp#c.workexp#c
> .workexp
> 
> esttab olsempocc2 olsempocc3 olsempocc4 isvempocc2 isvempocc3 isvempocc4 ///
> using "$Output\as_empocc.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(`labelVar' ///
>                                 occtenure "Occupation tenure" ///
>                                 c.occtenure#c.occtenure "Occ.ten.$^{2}\times 10
> 0$" ///
>                                 c.occtenure#c.occtenure#c.occtenure "Occ.ten.$^
> {3}\times 100$" ///
>                                 c.occtenure#c.occtenure#c.occtenure#c.occtenure
>  "Occ.ten.$^{4}\times 10000$" ///
>                                 ) ///
> transform(`transVar') ///
> nodep nonote nomtitles ///
> title(Earnings Function Estimates, using Sample up to 64-year-old, ///
> including Non-regular Workers and Specialists, ///
> Variables of Occupation Tenure are Controlled.) ///
> mgroups("OLS" "IV" ///
> pattern(1 0 0 1 0 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> 
> *** coefficients / emptenure
> local keepVar emptenure c.emptenure#c.emptenure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure#c.emptenure ///
>                                                 oj workexp c.workexp#c.workexp 
> ///
>                                                 c.workexp#c.workexp#c.workexp /
> //
>                                                 c.workexp#c.workexp#c.workexp#c
> .workexp
> 
> esttab olsemp2 olsemp3 olsemp4 isvemp2 isvemp3 isvemp4 ///
> using "$Output\as_emp.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(`labelVar') ///
> transform(`transVar') ///
> nodep nonote nomtitles ///
> title(Earnings Function Estimates, using Sample up to 64-year-old, ///
> including Non-regular Workers and Specialists, ///
> Variables of Occupation Tenure are not Controlled.) ///
> mgroups("OLS" "IV" ///
> pattern(1 0 0 1 0 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> 
> *** main table
> esttab olsemp2 olsempocc2 isvemp2 isvempocc2 ///
> using "$Output\as_main.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(`labelVar') ///
> transform(`transVar') ///
> nodep nonote nomtitles ///
> title(Earnings Function Estimates, using Sample up to 64-year-old, ///
> including Non-regular Workers and Specialists.) ///
> mgroups("OLS" "IV" ///
> pattern(1 0 1 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> 
> *** return
> esttab olsempr2 olsempoccr2 isvempr2 isvempoccr2 ///
> using "$Output\as_return.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(3._at 6._at 11._at 16._at 21._at 26._at) ///
> coeflabel(3._at "2 Years" ///
> 6._at "5 Years" 11._at "10 Years" ///
> 16._at "15 Years" ///
> 21._at "20 Years" 26._at "25 Years") ///
> nodep nonote nomtitles ///
> title(Estimated Returns to Employer Tenure, using Sample up to 64-year-old, ///
> including Non-regular Workers and Specialists.) ///
> mgroups("OLS" "IV" ///
> pattern(1 0 1 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> }
> }
> }
> 
> 
> 
> * 2. OLS->AS / under 60-year-old, firm size, non-specialist, regular employee
> {
> local subSample Yn Pr La Sm Rg
> foreach sub_i of local subSample{ /* loop within subsample */
>         do "$Code\ReadData.do"
>         /// criterion for making subsamples
>         if "`sub_i'"=="Yn"{ /* under 59-year-old */
>                 dis "/* under 59-year-old */"
>                 drop if age>=60
>                 sum age
>         }
>         else if "`sub_i'"=="Pr"{ /* non-professional */
>                 dis "/* non-professional */"
>                 drop if occ==10
>                 tab occ
>         }
>         else if "`sub_i'"=="La"{ /* large firm */
>                 dis "/* large firm */"
>                 keep if dsize==2
>                 tab dsize
>         }
>         else if "`sub_i'"=="Sm"{ /* small firm */
>                 dis "/* small firm */"
>                 drop if dsize==2
>                 tab dsize
>         }
>         else if "`sub_i'"=="Rg"{ /* regular employee */
>                 dis "/* regular employee */"
>                 drop if dregular==0
>         tab dregular
>         }
>         *** OLS
>         reg ///
>                 `commonVar' ///
>                 `emp2' ///
>                 , vce(r)
>                 est sto olsrob`sub_i'
>         
>         *** AS
>         qui {
>                 do "$Code\ConstructIV.do"
>                 ivregress 2sls ///
>                                                         `commonVar' ///
>                                                         (`emp2' = `empiv2') ///
>                                                         , vce(r)
>                 est sto isvrob`sub_i'
>                 drop if _est_isvrob`sub_i'==0
>                 drop *iv *iv? avg*
>                 **** re-build iv
>                 do "$Code\ConstructIV.do"
>         }
>         ivregress 2sls ///
>                                                 `commonVar' ///
>                                                 (`emp2' = `empiv2') ///
>                                                 , vce(r)
>         est sto isvrob`sub_i'
>         
>         *** culculation
>         est res olsrob`sub_i'
>         margins, exp(`culcemp2') ///
>         at(emptenure=(0(1)25)) noe post
>         est sto olsrobn`sub_i'
>         est res isvrob`sub_i'
>         margins, exp(`culcemp2') ///
>         at(emptenure=(0(1)25)) noe post
>         est sto isvrobn`sub_i'
> }
> *** plot
> qui coefplot (olsrobnYn, label(OLS)) (isvrobnYn, label(IV)), bylabel(Under 60-y
> ear-old) ///
> || (olsrobnRg, label(OLS)) (isvrobnRg, label(IV)), bylabel(Regular Employee) //
> /
> || (olsrobnPr, label(OLS)) (isvrobnPr, label(IV)), bylabel(Non-Professional) //
> /
> || (olsrobnLa, label(OLS)) (isvrobnLa, label(IV)), bylabel(Large Firm (Size>=50
> 0)) ///
> || (olsrobnSm, label(OLS)) (isvrobnSm, label(IV)), bylabel(Small Firm (Size<500
> )) ///
> ||, at ciopts(recast(rline) lpattern(dash)) recast(connected) ///
> xtitle("Employer Tenure") ytitle("Returns to Tenure on Earnings (%)") ///
> yline(0) rescale(100)
> graph export "$Output\plot_as_emp_rob.pdf", replace
> 
> 
> ** output tex all results
> qui{
> local keepVar emptenure c.emptenure#c.emptenure ///
>                                                 oj workexp c.workexp#c.workexp
> ** coefficients
> esttab olsrobYn isvrobYn olsrobLa isvrobLa ///
> olsrobSm isvrobSm olsrobPr isvrobPr olsrobRg isvrobRg ///
> using "$Output\as_emp_rob.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(`labelVar') ///
> transform(`transVar') ///
> nodep nonote nomtitles ///
> title(Earnings Function Estimates, using Various Subsamples.) ///
> mgroups("Under 59-year-old" "Large firms ($\geq500$)" ///
> "Small Firms ($<500$)" "Non-Professional" "Regular Employee" ///
> pattern(1 0 1 0 1 0 1 0 1 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> 
> **** return
> esttab olsrobnYn isvrobnYn olsrobnLa isvrobnLa ///
> olsrobnSm isvrobnSm olsrobnPr isvrobnPr olsrobnRg isvrobnRg ///
> using "$Output\as_return_rob.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(3._at 6._at 11._at 16._at 21._at 26._at) ///
> coeflabel(3._at "2 Years" ///
> 6._at "5 Years" 11._at "10 Years" ///
> 16._at "15 Years" ///
> 21._at "20 Years" 26._at "25 Years") ///
> nodep nonote nomtitles ///
> title(Estimated Returns to Employer Tenure, using Various Subsamples.) ///
> mgroups("Under 59-year-old" "Large firms ($\geq500$)" ///
> "Small Firms ($<500$)" "Non-Professional" "Regular Employee" ///
> pattern(1 0 1 0 1 0 1 0 1 0) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> }
> }
> 
> 
> 
> * 3. OLS->AS / tenure as dummy
> {
> ** tenure>=1, >=3, >=5, >=10, >=15
> *** simple dummy
> do "$Code\ReadData.do"
> sort empid year
> replace emptenure=40 if emptenure>=40
> est sto olsrobRg
> dis " /* simple dummy */ "
> reg ///
>         `commonVar' ///
>         i.emptenure c.workexp##c.workexp ///
>         , vce(r)
> est sto Dm
> 
> *** same equation as AS
> do "$Code\ReadData.do"
> sort empid year
> numlist "1 2 5 10 15 20 25 30"
> local tendm "`r(numlist)'"
> **** make emptenure dummy
> foreach i of local tendm {
>         gen emp`i'=1 if emptenure>=`i'
>         replace emp`i'=0 if emp`i'==.
> }
> dis " /* OLS dummy */ "
> reg ///
>         `commonVar' ///
>         emp1 emp2 emp5 emp10 emp15 emp20 emp25 emp30 ///
>         c.workexp##c.workexp ///
>         , vce(r)
> est sto olsempD
> 
> *** AS
> qui {
>         do "$Code\ConstructIV.do"
>         foreach i of local tendm {
>                 bysort empid (year): egen avgemp`i'=mean(emp`i')
>                 gen empiv`i'=emp`i'-avgemp`i'
>         }       
>         ivregress 2sls ///
>                         `commonVar' ///
>                         (emp1 emp2 emp5 emp10 emp15 emp20 emp25 emp30 ///
>                         c.workexp##c.workexp = ///
>                         empiv1 empiv2 empiv5 empiv10 empiv15 empiv20 empiv25 em
> piv30 ///
>                         workexpiv workexpiv2) ///
>                         , vce(r)
>         est sto isvempD
>         drop if _est_isvempD==0
>         drop *iv* avg*
>         **** re-build iv
>         do "$Code\ConstructIV.do"
>         foreach i of local tendm {
>                 bysort empid (year): egen avgemp`i'=mean(emp`i')
>                 gen empiv`i'=emp`i'-avgemp`i'
>         }
> }
> dis " /* AS's IV dummy */ "
> ivregress 2sls ///
>                 `commonVar' ///
>                 (emp1 emp2 emp5 emp10 emp15 emp20 emp25 emp30 ///
>                 c.workexp##c.workexp = ///
>                 empiv1 empiv2 empiv5 empiv10 empiv15 empiv20 empiv25 empiv30 //
> /
>                 workexpiv workexpiv2) ///
>                 , vce(r)
> est sto isvempD
>  
> *** output tex all results
> qui{
> local keepVar emp1 emp2 emp5 emp10 emp15 emp20 emp25 emp30 ///
>                                                 workexp c.workexp#c.workexp
> *** coefficients
> esttab olsempD isvempD ///
> using "$Output\as_emp_dm.tex", ///
> se star(* 0.1 ** 0.05 *** 0.01) b(4) ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(emp1 "$ T_{ij}\geq1$" emp2 "$ T_{ij}\geq2$" ///
> emp5 "$ T_{ij}\geq5$" emp10 "$ T_{ij}\geq10$" ///
> emp15 "$ T_{ij}\geq15$" emp20 "$ T_{ij}\geq20$" ///
> emp25 "$ T_{ij}\geq25$" emp30 "$ T_{ij}\geq30$" ///
> workexp "Total experience" c.workexp#c.workexp "Experience$^{2}$") ///
> nodep nonote nomtitles ///
> title(Estimated Returns to Employer Tenure, Employer Tenure is Treated as Dummy
>  Variables) ///
> mgroups("OLS" "IV" ///
> pattern(1 1) ///
> prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(lr){@span})) /
> //
> replace
> 
> *** simple dummy
> est res Dm
> qui coefplot, vertical yline(0) nolabel keep(*.emptenure) ///
> ciopts(recast(rline) lpattern(dash)) recast(connected)  rescale(100) ///
> xtitle("Employer Tenure") ytitle("Returns to Tenure on Earnings (%)") ///
> rename(1.emptenure=1 2.emptenure=2 3.emptenure=3 4.emptenure=4 5.emptenure=5 //
> /
> 6.emptenure=6 7.emptenure=7 8.emptenure=8 9.emptenure=9 10.emptenure=10 ///
> 11.emptenure=11 12.emptenure=12 13.emptenure=13 14.emptenure=14 15.emptenure=15
>  ///
> 16.emptenure=16 17.emptenure=17 18.emptenure=18 19.emptenure=19 20.emptenure=20
>  ///
> 21.emptenure=21 22.emptenure=22 23.emptenure=23 24.emptenure=24 25.emptenure=25
>  ///
> 26.emptenure=26 27.emptenure=27 28.emptenure=28 29.emptenure=29 30.emptenure=30
>  ///
> 31.emptenure=31 32.emptenure=32 33.emptenure=33 34.emptenure=34 35.emptenure=35
>  ///
> 36.emptenure=36 37.emptenure=37 38.emptenure=38 39.emptenure=39 40.emptenure=40
> )  ///
> title("Estimated Returns to Employer Tenure, Employer Tenure is Treated as Dumm
> y Variables")
> graph export "$Output\plot_as_dm.pdf", replace
> }
> }
> */
. 
. 
. * 4. Topel / 1-4 dimenational polynomial
. {
. qui{
. 
. do "$Code\ReadData.do"

. /* Title: ReadData */
. /// Date: Nov 5th, 2018
> /// Written by Ayaka Nakamura
> /// 
> /// This file reads data set
> 
. local inputfd "C:\Users\AyakaNakamura\Dropbox\materials\Works\Master\program\Su
> bmittion\Input"

. 
. qui {

. 
end of do-file
. program error:  matching close brace not found
r(198);

end of do-file

r(198);
. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. bysort empid (year): gen fst=1 ///
>                 if _n!=1&emptenure>=1
(3,222 missing values generated)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(3,972 missing values generated)
(3,227 missing values generated)
(3,972 missing values generated)
(3,227 missing values generated)
(3,972 missing values generated)
(3,227 missing values generated)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. replace fst=0 if fst==.|emptendif2==.
(3,972 real changes made)

. 
end of do-file

. drop initialemp fst emptendif* empexpdif*

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. 
. * making flag of sample used for first stage
. bysort empid (year): gen fst=1 ///
>                 if _n!=1&emptenure>=1
(3,222 missing values generated)

. replace fst=0 if fst==.|initialemp==.
(3,976 real changes made)

. 
. * generate difference of tenure for the flagged sample
. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)

. 
end of do-file

. drop initialemp fst emptendif* empexpdif*

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. 
. * making flag of sample used for first stage
. bysort empid (year): gen fst=1 ///
>                 if _n!=1&emptenure>=1
(3,222 missing values generated)

. 
. bysort empid (year): gen isOne=1 ///
>                 if emptenure-emptenure[_n-1]==1
(4,920 missing values generated)

. replace fst=0 if fst==.|initialemp==.
(3,976 real changes made)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. replace isOne=0 if isOne==.
(4,920 real changes made)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. * generate difference of tenure for the flagged sample
. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)
(3,976 missing values generated)

. 
end of do-file

. drop initialemp fst emptendif* empexpdif*

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. 
. * making flag of sample used for first stage
. bysort empid (year): gen fst=1 ///
>                 if emptenure-emptenure[_n-1]==1
(4,920 missing values generated)

. replace fst=0 if fst==.
(4,920 real changes made)

. 
. * generate difference of tenure for the flagged sample
. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(4,920 missing values generated)
(4,923 missing values generated)
(4,920 missing values generated)
(4,923 missing values generated)
(4,920 missing values generated)
(4,923 missing values generated)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. replace initialemp=0 if initialemp<0
(0 real changes made)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. bysort empid (year): gen empwagedif=realwage-realwage[_n-1] ///
>                 if fst==1
(5,926 missing values generated)

. 
end of do-file

. sum empwagedif

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  empwagedif |      5,582   -.0303238    .3857878  -3.223395   2.332508

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. tabulate year, generate(y)

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2004 |        878        7.63        7.63
       2005 |        720        6.26       13.89
       2006 |        626        5.44       19.33
       2007 |        867        7.53       26.86
       2008 |        786        6.83       33.69
       2009 |      1,462       12.70       46.39
       2010 |      1,335       11.60       57.99
       2011 |      1,245       10.82       68.81
       2012 |      1,359       11.81       80.62
       2013 |      1,059        9.20       89.82
       2014 |      1,171       10.18      100.00
------------+-----------------------------------
      Total |     11,508      100.00

. rename ( y# ) ( y# ), addnum(2004)

. 
end of do-file

. drop initialemp fst emptendif* empexpdif*

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. replace initialemp=0 if initialemp<0
(0 real changes made)

. 
. * making flag of sample used for first stage
. bysort empid (year): gen fst=1 ///
>                 if _n!=1 | emptenure-emptenure[_n-1]==1
(3,177 missing values generated)

. replace fst=0 if fst==.
(3,177 real changes made)

. 
. * generate difference of tenure for the flagged sample
. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(3,927 missing values generated)
(3,182 missing values generated)
(3,927 missing values generated)
(3,182 missing values generated)
(3,927 missing values generated)
(3,182 missing values generated)

. 
end of do-file

. drop initialemp fst emptendif* empexpdif*

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. sort empid year

. gen initialemp=workexp-emptenure
(1,157 missing values generated)

. replace initialemp=0 if initialemp<0
(0 real changes made)

. 
. * making flag of sample used for first stage
. bysort empid (year): gen fst=1 ///
>                 if _n!=1 & emptenure-emptenure[_n-1]==1
(4,920 missing values generated)

. replace fst=0 if fst==.
(4,920 real changes made)

. 
. * generate difference of tenure for the flagged sample
. forvalues i=2/4 {
  2.         bysort empid (year): gen emptendif`i'=(emptenure^`i')-emptenure[_n-1
> ]^`i' ///
>                 if fst==1
  3.         bysort id (year): gen empexpdif`i'=(workexp^`i')-workexp[_n-1]^`i' /
> //
>                 if fst==1
  4. }
(4,920 missing values generated)
(4,923 missing values generated)
(4,920 missing values generated)
(4,923 missing values generated)
(4,920 missing values generated)
(4,923 missing values generated)

. 
end of do-file

. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. global Group "OLS" "IV"

. 
end of do-file

. dis $Group
OLS" "IV invalid name
r(198);

. dis "$Group"
OLSIV

. 
. do "C:\Users\AYAKAN~1\AppData\Local\Temp\STD178c_000000.tmp"

. local labelVar emptenure "Employer tenure" ///
>                                                 c.emptenure#c.emptenure "Emp.te
> n.$^{2}\times 100$" ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure "Emp.ten.$^{3}\times 100$" ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure#c.emptenure "Emp.ten.$^{4}\times 1000$" ///
>                                                 oj "Old job" ///
>                                                 workexp "Total experience" c.wo
> rkexp#c.workexp "Experience$^{2}$" ///
>                                                 c.workexp#c.workexp#c.workexp "
> Exp.$^{3}\times 100$" ///
>                                                 c.workexp#c.workexp#c.workexp#c
> .workexp "Exp.$^{4}\times 10000$"

. local transVar c.emptenure#c.emptenure 100*@ 100 ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure 100*@ 100 ///
>                                                 c.emptenure#c.emptenurec.empten
> ure#c.emptenure 10000*@ 10000 ///
>                                                 c.workexp#c.workexp#c.workexp 1
> 00*@ 100 ///
>                                                 c.workexp#c.workexp#c.workexp 1
> 0000*@ 10000 ///
>                                                 c.occtenure#c.occtenure 100*@ 1
> 00 ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure 100*@ 100 ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure#c.occtenure 10000*@ 10000

. local comSet prefix(\multicolumn{@span}{c}{) suffix(}) span erepeat(\cmidrule(l
> r){@span})) ///
>                                         se star(* 0.1 ** 0.05 *** 0.01) b(4) //
> /
>                                         nodep nonote nomtitles ///
>                                         replace

. 
. *** coefficients / emp+occ
. local keepVar emptenure c.emptenure#c.emptenure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure ///
>                                                 c.emptenure#c.emptenure#c.empte
> nure#c.emptenure ///
>                                                 oj ///
>                                                 occtenure c.occtenure#c.occtenu
> re ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure ///
>                                                 c.occtenure#c.occtenure#c.occte
> nure#c.occtenure ///
>                                                 workexp c.workexp#c.workexp ///
>                                                 c.workexp#c.workexp#c.workexp /
> //
>                                                 c.workexp#c.workexp#c.workexp#c
> .workexp

. 
. esttab olsempocc2 olsempocc3 olsempocc4 isvempocc2 isvempocc3 isvempocc4 ///
> using "$Output\as_empocc.tex", ///
> keep(`keepVar') ///
> order(`keepVar') ///
> coeflabel(`labelVar' ///
>                                 occtenure "Occupation tenure" ///
>                                 c.occtenure#c.occtenure "Occ.ten.$^{2}\times 10
> 0$" ///
>                                 c.occtenure#c.occtenure#c.occtenure "Occ.ten.$^
> {3}\times 100$" ///
>                                 c.occtenure#c.occtenure#c.occtenure#c.occtenure
>  "Occ.ten.$^{4}\times 10000$" ///
>                                 ) ///
> transform(`transVar') ///
> title(Earnings Function Estimates, using Sample up to 64-year-old, ///
> including Non-regular Workers and Specialists, ///
> Variables of Occupation Tenure are Controlled.) ///
> mgroups("OLS" "IV" ///
> pattern(1 0 0 1 0 0) ///
> `comSet'
(output written to C:\Users\AyakaNakamura\Dropbox\materials\Works\Master\program\
> Submittion\Output\as_empocc.tex)

. 
end of do-file

